<!DOCTYPE html>
<html>
	<head>
	<meta charset="utf-8">
	<!-- Bootstrap core CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/bootstrap-table.min.css') }}" rel="stylesheet">
    <!-- JavaScript -->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <script src="static/js/bootstrap-table.min.js"></script>
    <!-- Own JavaScript -->
    <!-- <script src="static/js/ownjs/retire.js"></script> -->
	</head>
<body>
	<div class="container">
  	<form action='/retire' id="retireForm" method="post">
  		<!-- Example single danger button -->
		<div class="btn-group">
		<button id="myDropdown" type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			普通场
		</button>
		  	<div class="dropdown-menu" >
		    <a class="dropdown-item" href="#">普通场</a>
		    <a class="dropdown-item" href="#">癞子场</a>
		    <a class="dropdown-item" href="#">双癞子场</a>
		    <div class="dropdown-divider"></div>
		    <a class="dropdown-item" href="#">四人场</a>
		  	</div>
		</div>
        <table id="retireTable">
        <thead>
            <tr>
            	<th data-field="host">域名</th>
                <th data-field="level">Level</th>
                <th data-field="playnum">在玩人数</th>
                <th data-field="option">操作</th>
            </tr>
        </thead>
    	</table>
    	<input type="hidden" id="opform" name='opform' value={{request.form['opform']}}>
    	<button type="submit" name="allretire" class="btn btn-primary btn-lg">全部退休</button>
  	</form>
  	<script>
		function AddTableOption() {
			// var rowNum = $('#retireTable').bootstrapTable('totalRows');
			var rowNum = $('#retireTable').bootstrapTable('getData').length;
		    for(i = 0; i < rowNum; i++)
		    {
				UpdateTableCell(i, "option", '<button type="button" name="oneretire" class="btn btn-success">退休操作</button>');   	
		    }
		};
		
		//更新单元格内容
		function UpdateTableCell(row, field, val){
			// 更新表格列"option"展示变为按钮
		    $('#retireTable').bootstrapTable('updateCell', {
                index: row,
                field: field,
                value: val,
            });			
		};
		
		$("btn btn-success").click(function(e) {
			var tbldata = JSON.stringify($('#retireTable').bootstrapTable('getData'));
			alert(tbldata);
			$('#opform').val(tbldata);
		    $('#retireForm').submit();	
		});
		
		// 下拉框变化
		// 所有下拉框执行同一个事件回调函数,class=".dropdown-item"
		$(".dropdown-item").click(function(e) {			
			// document.getElementById('myDropdown').textContent = e.target.text;
			$('#myDropdown').textContent = e.target.text;
			// 提交表单获取场次信息
			var tbldata = JSON.stringify($('#retireTable').bootstrapTable('getData'));
			alert(tbldata);
			$('#opform').val(tbldata);
		    $('#retireForm').submit();
			e.preventDefault();
		});
		
		// 表格展示
		$(function InitTable() {
			// 引用html变量changci
			var points = JSON.parse('{{ changci|safe }}');
			// 重新加载场次信息
		    $('#retireTable').bootstrapTable({
		        data: points
		    });
		    AddTableOption();
		});
	</script>
	</div>
</body>
</html>